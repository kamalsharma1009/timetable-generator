{% extends "base.html" %}

{% block title %}Batch Mentors - Timetable Generator{% endblock %}
{% block page_title %}Assign Batch Mentors{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex justify-between items-start">
        <div>
            <h2 class="text-2xl font-bold text-gray-900">{{ class_obj.name }} ({{ class_obj.code }})</h2>
            <p class="mt-1 text-gray-600">
                {{ class_obj.department.name }} • Year {{ class_obj.year }} • Semester {{ class_obj.semester }}
            </p>
        </div>
        <div class="flex space-x-2">
            <a href="{{ url_for('manage_class_subjects', class_id=class_obj.id) }}" 
               class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                <i class="fas fa-book mr-2"></i>Subjects
            </a>
            <a href="{{ url_for('manage_classes') }}" 
               class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </a>
        </div>
    </div>
</div>

<!-- Information Card -->
<div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
    <div class="flex items-start">
        <i class="fas fa-info-circle text-blue-500 text-xl mt-1 mr-3"></i>
        <div>
            <h3 class="text-lg font-medium text-blue-900 mb-2">About Batch Mentors</h3>
            <p class="text-blue-700">
                Each batch (TB1, TB2, TB3) requires one mentor faculty. Mentors conduct weekly mentoring sessions 
                (1 hour per week) and provide guidance to students. These sessions are scheduled in the timetable.
            </p>
        </div>
    </div>
</div>

<!-- Batches Grid -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    {% for batch in batches %}
    <div class="bg-white rounded-lg shadow border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">{{ batch.name }}</h3>
            <p class="text-sm text-gray-600">Batch Code: {{ batch.code }}</p>
        </div>
        
        <div class="p-6">
            <form method="POST" action="{{ url_for('assign_batch_mentor') }}">
                <input type="hidden" name="batch_id" value="{{ batch.id }}">
                
                <div class="mb-4">
                    <label for="mentor_id_{{ batch.id }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Select Mentor
                    </label>
                    <select id="mentor_id_{{ batch.id }}" name="mentor_id" required
                            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500">
                        <option value="">Select Faculty</option>
                        {% for faculty in faculty_list %}
                        <option value="{{ faculty.id }}" {% if batch.mentor_id == faculty.id %}selected{% endif %}>
                            {{ faculty.name }} 
                            {% if faculty.department %}
                                ({{ faculty.department.name }})
                            {% endif %}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                    <div class="text-sm text-gray-700">
                        <div class="font-medium mb-1">Current Mentor:</div>
                        <div class="text-gray-900">
                            {% if batch.mentor %}
                                <div class="flex items-center">
                                    <i class="fas fa-user-tie text-primary-600 mr-2"></i>
                                    <span>{{ batch.mentor.name }}</span>
                                </div>
                                <div class="text-xs text-gray-600 mt-1">
                                    {{ batch.mentor.designation or 'Faculty' }}
                                    {% if batch.mentor.department %}
                                        • {{ batch.mentor.department.name }}
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-red-500">Not assigned</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <button type="submit" 
                        class="w-full px-4 py-2 {% if batch.mentor %}bg-green-600 hover:bg-green-700{% else %}bg-primary-600 hover:bg-primary-700{% endif %} text-white rounded-md">
                    {% if batch.mentor %}
                        <i class="fas fa-sync-alt mr-2"></i>Update Mentor
                    {% else %}
                        <i class="fas fa-user-plus mr-2"></i>Assign Mentor
                    {% endif %}
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Next Steps -->
<div class="mt-8 bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-medium text-gray-900 mb-4">Next Steps</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <a href="{{ url_for('manage_class_subjects', class_id=class_obj.id) }}"
           class="p-4 border border-gray-200 rounded-lg hover:border-primary-300 hover:shadow-md transition">
            <div class="flex items-center mb-3">
                <div class="rounded-full bg-blue-100 p-2 mr-3">
                    <i class="fas fa-book text-blue-600"></i>
                </div>
                <h4 class="font-medium text-gray-900">Assign Subjects</h4>
            </div>
            <p class="text-sm text-gray-600">
                Add subjects to this class with faculty and weekly hours.
            </p>
        </a>
        
        <div class="p-4 border border-gray-200 rounded-lg bg-gray-50">
            <div class="flex items-center mb-3">
                <div class="rounded-full bg-yellow-100 p-2 mr-3">
                    <i class="fas fa-user-tie text-yellow-600"></i>
                </div>
                <h4 class="font-medium text-gray-900">Assign Mentors</h4>
            </div>
            <p class="text-sm text-gray-600">
                <span class="font-medium text-green-600">Current Step</span> - Assign mentors to all 3 batches.
            </p>
        </div>
        
        <a href="{{ url_for('run_timetable_generation', class_id=class_obj.id) }}"
           class="p-4 border border-gray-200 rounded-lg hover:border-green-300 hover:shadow-md transition">
            <div class="flex items-center mb-3">
                <div class="rounded-full bg-green-100 p-2 mr-3">
                    <i class="fas fa-cogs text-green-600"></i>
                </div>
                <h4 class="font-medium text-gray-900">Generate Timetable</h4>
            </div>
            <p class="text-sm text-gray-600">
                Generate complete timetable using genetic algorithm.
            </p>
        </a>
    </div>
</div>

<!-- Status Check -->
<div class="mt-6">
    {% set assigned_mentors = batches|selectattr('mentor_id')|list|length %}
    <div class="{% if assigned_mentors == 3 %}bg-green-50 border-green-200{% else %}bg-yellow-50 border-yellow-200{% endif %} border rounded-lg p-4">
        <div class="flex items-center">
            <i class="fas {% if assigned_mentors == 3 %}fa-check-circle text-green-500{% else %}fa-exclamation-triangle text-yellow-500{% endif %} text-xl mr-3"></i>
            <div>
                <h4 class="font-medium {% if assigned_mentors == 3 %}text-green-900{% else %}text-yellow-900{% endif %}">
                    Mentoring Status: {{ assigned_mentors }}/3 batches have mentors
                </h4>
                <p class="text-sm {% if assigned_mentors == 3 %}text-green-700{% else %}text-yellow-700{% endif %} mt-1">
                    {% if assigned_mentors == 3 %}
                        All batches have mentors assigned. You can proceed to timetable generation.
                    {% else %}
                        Assign mentors to all {{ 3 - assigned_mentors }} remaining batches.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}